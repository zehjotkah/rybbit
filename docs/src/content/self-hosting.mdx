import { Steps } from 'nextra/components'
import { Callout } from 'nextra/components'

# Self Hosting Guide

This guide will walk you through setting up your own instance of Rybbit.

## Prerequisites

Before you begin, ensure you have the following:

-   **A Linux VPS:** We use [Hetzner Cloud](https://hetzner.cloud/?ref=QEdVqVpTLBDP) for everything (referral link - but Hetzner is legitimately the best value). CX11 for ~$4/month will be fine for small-medium sized projects. we recommend choosing a VPS with at least 2GB of RAM.
-   **A Domain Name:** You'll need a domain or subdomain (e.g., `tracking.yourdomain.com`) pointed to your VPS's IP address. HTTPS is required because browsers block tracking scripts served over insecure HTTP.
-   **Git:** Needed to clone the repository.

<Callout type="info">
  This guide has been tested on Ubuntu 24 LTS. While it should work on other distributions, your mileage may vary.
</Callout>

## Setup Steps

<Steps>
### 1. Point Your Domain to Your VPS

Configure your domain's DNS settings to point to your VPS's public IP address. This usually involves:

1.  Finding your VPS's public IPv4 address (from your hosting provider, e.g., Hetzner).
2.  Logging into your domain registrar or DNS provider (e.g., GoDaddy, Namecheap, Cloudflare).
3.  Adding an `A` record:
    *   **Host/Name:** Your desired subdomain (e.g., `tracking`) or `@` for the root domain.
    *   **Value:** Your VPS's IPv4 address.
    *   **TTL:** Default or a low value (e.g., 300 seconds) for faster updates.

DNS changes might take some time to propagate globally. Use [DNS Checker](https://dnschecker.org/) to verify.

### 2. Install Docker Engine

Connect to your VPS via SSH.

Follow the official Docker Engine installation instructions for your Linux distribution:
[https://docs.docker.com/engine/install/](https://docs.docker.com/engine/install/)

### 3. Clone the Rybbit Repository

Clone the project repository from GitHub (Git is usually pre-installed on most server distributions):
```bash
git clone https://github.com/rybbit-io/rybbit.git
cd rybbit
```

### 4. Run the Setup Script

The repository includes a setup script that configures the necessary environment variables (including generating a secure secret) and starts the application using Docker Compose.

<Callout type="warning">
  Important: Make all scripts executable before proceeding!
  ```bash
  chmod +x *.sh
  ```
</Callout>

Run the setup script, replacing `your.domain.name` with the domain or subdomain you configured in the prerequisites:
```bash
./setup.sh your.domain.name
```

The script will create a `.env` file and then build and start the containers. This might take a few minutes the first time.

#### Setup Script Options

The setup script supports several options:

```bash
./setup.sh <domain_name> [options]
```

Available options:
- `--no-webserver`: Disable the built-in Caddy webserver
- `--backend-port <port>`: Set custom host port for backend (default: 3001)
- `--client-port <port>`: Set custom host port for client (default: 3002)
- `--help`: Show help message

Examples:
```bash
# Custom ports with built-in webserver
./setup.sh tracking.example.com --backend-port 8080 --client-port 8081

# Custom ports with your own webserver
./setup.sh tracking.example.com --no-webserver --backend-port 8080 --client-port 8081
```

<Callout type="info">
  When you specify custom ports, only the host port mapping changes. Inside the Docker containers, the services still use ports 3001 and 3002.
</Callout>

#### Using Your Own Web Server

If you prefer to use your own web server (such as Nginx or Apache) instead of the built-in Caddy server, you can use the `--no-webserver` flag:

```bash
./setup.sh your.domain.name --no-webserver
```

This will:
- Not start the Caddy container
- Expose the backend service on host port 3001 (or your custom port)
- Expose the client service on host port 3002 (or your custom port)

You'll need to configure your web server to proxy requests to these services. Here's an example Nginx configuration:

```nginx
server {
    listen 80;
    server_name your.domain.name;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name your.domain.name;

    # SSL configuration (using Let's Encrypt)
    ssl_certificate /etc/letsencrypt/live/your.domain.name/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your.domain.name/privkey.pem;

    # API requests - adjust port if you customized it
    location /api/ {
        proxy_pass http://localhost:3001;  # or your custom port
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Client app - adjust port if you customized it
    location / {
        proxy_pass http://localhost:3002;  # or your custom port
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 5. Sign Up

Once the services are running and DNS has propagated, Caddy (the webserver) will automatically obtain an SSL certificate for your domain.

Open your browser and navigate to `https://your.domain.name/signup` (using the domain you provided to the setup script).

Create your admin account. You can then log in and start adding your websites!

</Steps>

## Managing Your Installation

Rybbit comes with several helper scripts to manage your installation:

<Callout type="info">
  If you haven't done so already, make sure all scripts are executable:
  ```bash
  chmod +x *.sh
  ```
</Callout>

- **start.sh**: Start all services after they've been stopped
  ```bash
  ./start.sh
  ```

- **stop.sh**: Stop all running services
  ```bash
  ./stop.sh
  ```

- **restart.sh**: Restart all services
  ```bash
  ./restart.sh
  ```

- **update.sh**: Update to the latest version by pulling new code and rebuilding containers
  ```bash
  ./update.sh
  ```

<Callout>
If you are using your self-hosted Rybbit without anyone else, you can disable new user signups by setting `DISABLE_SIGNUP=true` in the `.env` file at the root of the repository.
</Callout>
{/* 
## Security Recommendation: Firewall Configuration

For enhanced security, it is highly recommended to configure a firewall on your VPS. Allow incoming connections only on the ports necessary for the application to function externally. In most standard setups, this means allowing traffic only on port `443` (HTTPS).

The exact commands depend on the firewall software used (e.g., `ufw` for Ubuntu, `firewalld` for CentOS).

Example using `ufw` (Uncomplicated Firewall) on Ubuntu:
```bash
sudo ufw allow ssh   # Keep SSH access (usually port 22)
sudo ufw allow 443/tcp # Allow HTTPS traffic
sudo ufw enable     # Enable the firewall
sudo ufw status     # Check the status
```

<Callout type="warning">
Ensure you allow SSH access (typically port 22) before enabling the firewall, otherwise you might lock yourself out of your VPS!
</Callout> */}

If you run into any issues or need help, feel free to join our Discord community!
